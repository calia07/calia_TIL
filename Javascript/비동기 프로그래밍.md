# 비동기 프로그래밍
<br>

## 1. 동기 처리와 비동기 처리
#### 함수 호출 시 함수 실행 컨텍스트가 생성되고 콜 스택에 푸시되고 함수 코드가 실행, 종료하면 팝되어 제거된다.

```javascript
const foo = () => {};
const bar = () => {};

foo();
bar();
```
#### 자바스크립트는 단 하나의 실행 컨텍스트를 가짐 = 2개 이상의 함수를 동시에 실행할 수 없음
#### 싱글 스레드 방식으로 동작하므로 처리에 시간이 걸리는 태스크를 실행하는 경우 블로킹(작업 중단)이 발생한다.
<br>

#### ex) 비동기적 코드의 예
```javascript
function sleep(func, delay){
  const delayUntil = Date.now() + delay;
  while(Date.now()<delayUntil);
  func();
}

function foo(){
  console.log('foo');
};

sleep(foo, 3*1000);

```
#### 위 코드의 경우 sleep 함수는 setTimeout과 유사한 역할을 함수이고 3초 이상 호출되지 못하고 blocking을 일으킨다.
<br>

#### ex) 동기적 코드의 예
```javascript


function foo(){
  console.log('foo');
};

function bar(){
  console.log('bar');
};

setTimeout(foo, 3000);
bar();

```
#### 위 코드의 경우 setTimeout 이후의 함수를 블로킹하지 않고 바로 실행하는 방식으로 동기적인 방식이다.
- #### 동기 처리 방식 : 실행 순서 보장하지만 블로킹되는 단점이 존재
- #### 비동기 처리 방식 : 블로킹이 발생하지 않으나 실행 순서 보장 못함 (콜백 패턴 사용하며 예시로는 setTImeout, setInterval, HTTP 요청, event Handler)


<br><br>
## 2. 이벤트 루프와 태스크 큐
- #### 이벤트 루프 : 브라우저 내장 기능 중 하나로 콜 스택에 현재 실행 중인 실행 컨텍스트가 있는지, 그리고 태스크 큐에 대기중인 함수가 있는지 확인하여 만약 콜스택이 비어있고 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 태스크 큐에 대기중인 함수를 콜 스택으로 이동시킴
- #### 태스크 큐 : 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
#### 자바스크립트 엔진은 2개의 영역(콜 스택, 힙)으로 구분되며 단순히 태스크 요청시 콜 스택을 통해 실행
#### 비동기 처리에서 브라우저 또는 Node.js가 호출 스케줄링을 위한 타이머 설정과 콜백 함수 등록 등의 일을 한다.
- #### 예제

```javascript
function foo(){
  console.log('foo');
};

function bar(){
  console.log('bar');
};

setTimeout(foo,0);
bar();

```
<br>

   ##### 1) 전역 코드 평가로 전역 실행 컨텍스트 생성되고 콜 스택에 푸시됨
   ##### 2) 전역 코드 실행으로 setTimeout 호출하여 함수 실행 컨텍스트가 생성되고 콜 스택에 푸시되어 현재 실행 중인 실행 컨텍스트가 됨
   ##### 3) setTimeout 함수 실행 시 콜백 함수를 호출 스케줄링하고 종료되어 콜 스택에서 팝됨(브라우저의 역할)
   ##### 4) 브라우저는 타이머를 설정하고 만료되면 콜백 함수 foo가 태스크 큐에 푸시되어 대기하고 있고 bar 함수가 호출되어 실행 컨텍스트가 생성되고 콜 스택에 푸시되어 실행 컨텍스트가 됨
   ##### 5) bar 함수 종료되면 콜 스택에서 팝되고 전역 코드 실행이 종료되어 전역 실행 컨텍스트가 콜 스택에서 팝됨
   ##### 6) 이벤트 루프에 의해 콜 스택이 비어있음을 알게 되고 태스크 큐에서 대기 중인 foo가 이벤트 루프에 의해 콜 스택에 푸시되어 실행되고 종료되어 팝됨
    
   #### 비동기 함수인 setTiemout의 콜백함수는 태스크 큐에 푸시되어 대기하다가 콜 스택이 비게되면 콜 스택에 푸시되어 실행
   #### 자바스크립트는 싱글 스레드 방식이지만 브라우저는 멀티 스레드 방식

<br><br><br>
<hr>
    
#### 출처 : [모던 자바스크립트 Deep Dive(이웅모 지음) - 위키북스]
    

